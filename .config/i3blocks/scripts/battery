#!/usr/bin/env bash

VOLTAGE_FILE=${1:-"/sys/class/power_supply/hidpp_battery_1/voltage_now"}

LEVELS=(
    4186 # 100%
    4156 # 99%
    4156 # 99%
    4143 # 98%
    4133 # 97%
    4122 # 96%
    4113 # 95%
    4103 # 94%
    4094 # 93%
    4086 # 92%
    4076 # 91%
    4067 # 90%
    406  # 89%
    4051 # 88%
    4043 # 87%
    4036 # 86%
    4027 # 85%
    4019 # 84%
    4012 # 83%
    4004 # 82%
    3997 # 81%
    3989 # 80%
    3983 # 79%
    3976 # 78%
    3969 # 77%
    3961 # 76%
    3955 # 75%
    3949 # 74%
    3942 # 73%
    3935 # 72%
    3929 # 71%
    3922 # 70%
    3916 # 69%
    3909 # 68%
    3902 # 67%
    3896 # 66%
    389  # 65%
    3883 # 64%
    3877 # 63%
    387  # 62%
    3865 # 61%
    3859 # 60%
    3853 # 59%
    3848 # 58%
    3842 # 57%
    3837 # 56%
    3833 # 55%
    3828 # 54%
    3824 # 53%
    3819 # 52%
    3815 # 51%
    3811 # 50%
    3808 # 49%
    3804 # 48%
    38   # 47%
    3797 # 46%
    3793 # 45%
    379  # 44%
    3787 # 43%
    3784 # 42%
    3781 # 41%
    3778 # 40%
    3775 # 39%
    3772 # 38%
    377  # 37%
    3767 # 36%
    3764 # 35%
    3762 # 34%
    3759 # 33%
    3757 # 32%
    3754 # 31%
    3751 # 30%
    3748 # 29%
    3744 # 28%
    3741 # 27%
    3737 # 26%
    3734 # 25%
    373  # 24%
    3726 # 23%
    3724 # 22%
    372  # 21%
    3717 # 20%
    3714 # 19%
    371  # 18%
    3706 # 17%
    3702 # 16%
    3697 # 15%
    3693 # 14%
    3688 # 13%
    3683 # 12%
    3677 # 11%
    3671 # 10%
    3666 # 9%
    3662 # 8%
    3658 # 7%
    3654 # 6%
    3646 # 5%
    3633 # 4%
    3612 # 3%
    3579 # 2%
    3537 # 1%
    35   # 0%
)

VOLTAGE=$(cat $VOLTAGE_FILE)
VOLTAGE=${VOLTAGE::-3}

for i in "${!LEVELS[@]}"; do
    if [ "$VOLTAGE" -ge "${LEVELS[$i]}" ]; then
        echo $LABEL$((100 - $i))$POSTFIX
        break
    fi
done
